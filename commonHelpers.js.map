{"version":3,"file":"commonHelpers.js","sources":["../src/pixabay-api.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst KEY = '42274052-b5209bd40b827282c0377ed93';\n\nconst baseSearchParams = {\n  key: KEY,\n  image_type: 'photo',\n  orientation: 'horizontal',\n  safesearch: true,\n  per_page: 40,\n};\n\nexport const fetchImages = async (q, page) => {\n  const { data } = await axios.get(`${BASE_URL}`, {\n    params: { ...baseSearchParams, q, page },\n  });\n  return data;\n};","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { fetchImages } from './pixabay-api';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst refs = {\n  form: document.querySelector('.search-form'),\n  input: document.querySelector('.input'),\n  searchBtn: document.querySelector('.search-btn'),\n  list: document.querySelector('.gallery'),\n  loader: document.querySelector('.loader'),\n  sentinel: document.querySelector('.sentinel'),\n};\n\nlet page = 1;\nlet query = '';\nlet uploadedImages = 0;\nlet totalImages = 0;\nlet modalLightbox;\n\nrefs.form.addEventListener('submit', handleSeachBtnClick);\n\nasync function handleSeachBtnClick(e) {\n  observer.disconnect(refs.sentinel);\n  e.preventDefault();\n  refs.loader.classList.remove('hidden');\n  page = 1;\n  query = '';\n  uploadedImages = 0;\n  totalImages = 0;\n\n  if (!e.currentTarget.searchQuery.value.trim()) {\n    iziToast.error({\n      message: `Sorry, your search query is empty. Please try again.`,\n      position: 'topRight',\n      transitionIn: 'fadeInRight',\n      transitionOut: 'fadeOutLeft',\n      backgroundColor: 'orange',\n    });\n    refs.loader.classList.add('hidden');\n    refs.list.innerHTML = '';\n    return;\n  }\n\n  try {\n    query = e.currentTarget.searchQuery.value.trim();\n    const data = await fetchImages(\n      e.currentTarget.searchQuery.value.trim(),\n      page\n    );\n    onSuccess(data);\n    if (uploadedImages >= totalImages && uploadedImages > 0) {\n      iziToast.info({\n        message: `We're sorry, but you've reached the end of search results.`,\n        position: 'topRight',\n        transitionIn: 'fadeInRight',\n        transitionOut: 'fadeOutLeft',\n      });\n    }\n  } catch (error) {\n    refs.loader.classList.add('hidden');\n    iziToast.error({\n      message: `${error.message}`,\n      position: 'topRight',\n      transitionIn: 'fadeInRight',\n      transitionOut: 'fadeOutLeft',\n      backgroundColor: 'orange',\n    });\n  }\n  observer.observe(refs.sentinel);\n  e.target.reset();\n}\n\nfunction onSuccess(data) {\n  refs.loader.classList.add('hidden');\n  if (!data.totalHits) {\n    iziToast.error({\n      message: `Sorry, there are no images matching your search query. Please try again.`,\n      position: 'topRight',\n      transitionIn: 'fadeInRight',\n      transitionOut: 'fadeOutLeft',\n      backgroundColor: 'orange',\n    });\n    refs.list.innerHTML = '';\n    return;\n  }\n  page += 1;\n  totalImages = data.totalHits;\n  uploadedImages += data.hits.length;\n  iziToast.success({\n    message: `Hooray! We found ${data.totalHits} images.`,\n    position: 'topRight',\n    transitionIn: 'fadeInRight',\n    transitionOut: 'fadeOutLeft',\n    backgroundColor: 'green',\n  });\n  refs.list.innerHTML = markup(data);\n  modalLightbox = new SimpleLightbox('.gallery a', {\n    captionDelay: 250,\n  });\n  modalLightbox.refresh();\n}\n\nfunction markup({ hits }) {\n  const result = hits\n    .map(el => {\n      return `<a class=\"link\" href=${el.largeImageURL} id=${el.id}><div class=\"photo-card\" >\n    <div class=\"img-wrap\"><img src=${el.webformatURL} alt=${el.tags} loading=\"lazy\"/></div>\n    <div class=\"info\">\n        <p class=\"info-item\">\n            <b>Likes</b>\n            <span>${el.likes}</span>\n        </p>\n        <p class=\"info-item\">\n            <b>Views</b>\n            <span>${el.views}</span>\n        </p>\n        <p class=\"info-item\">\n            <b>Comments</b>\n            <span>${el.comments}</span>\n        </p>\n        <p class=\"info-item\">\n            <b>Downloads</b>\n            <span>${el.downloads}</span>\n        </p>\n    </div>\n</div></a>`;\n    })\n    .join('');\n  return result;\n}\n\nasync function loadMoreImages() {\n  modalLightbox.destroy();\n\n  try {\n    const data = await fetchImages(query, page);\n    refs.list.insertAdjacentHTML('beforeend', markup(data));\n    page += 1;\n    uploadedImages += data.hits.length;\n    modalLightbox = new SimpleLightbox('.gallery a', {\n      captionDelay: 250,\n    });\n    if (uploadedImages >= totalImages) {\n      iziToast.info({\n        message: `We're sorry, but you've reached the end of search results.`,\n        position: 'toptopRight',\n        transitionIn: 'fadeInRight',\n        transitionOut: 'fadeOutLeft',\n      });\n    }\n  } catch (error) {\n    iziToast.error({\n      message: `${error.message}`,\n      position: 'topRight',\n      transitionIn: 'fadeInRight',\n      transitionOut: 'fadeOutLeft',\n    });\n  }\n}\n\nconst intersectionObserve = entries => {\n  entries.forEach(entry => {\n    if (entry.isIntersecting && query !== '' && uploadedImages < totalImages) {\n      loadMoreImages();\n    }\n  });\n};\n\nconst observer = new IntersectionObserver(intersectionObserve, {\n  rootMargin: '200px',\n});\n"],"names":["BASE_URL","KEY","baseSearchParams","fetchImages","q","page","data","axios","refs","query","uploadedImages","totalImages","modalLightbox","handleSeachBtnClick","observer","iziToast","onSuccess","error","markup","SimpleLightbox","hits","el","loadMoreImages","intersectionObserve","entries","entry"],"mappings":"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"}